@model chat.ViewModels.AllChatsViewModel

<div class="container-fluid ">
    <div class="row d-flex justify-content-start ">
        <div class="col-md-4 order-md-1">

            <form class="example" action="action_page.php">
                <input class="cardpressed search text-white" type="text" placeholder="Search chat.." name="search">
                <button class="search-button" type="submit"><i class="text-white fa fa-search"></i></button>
            </form>
            <ul class="list-unstyled">
                @if (Model.ChatList != null)
                    @foreach (var chat in Model.ChatList)
                    {
                        <li class="list-group-flush flex-column align-items-start chatcard chat-item text-light">
                            <div class="d-flex w-100 justify-content-between">
                                <div class="logo text-white"><i class="fa fa-snapchat"></i></div>
                                <div class="w-100">
                                    <div class="d-flex w-75 justify-content-between">
                                        @*<h5 class="mb-1">@chat.Chat.ChatName</h5>*@
                                        <form asp-action="AllChats" asp-route-chatId="@chat.ChatId" method="post">
                                            <button type="submit" class="mb-1">@chat.Chat.ChatName</button>
                                        </form>
                                        <small id="whenToChat @chat.ChatId">@chat.Chat.LastMessageWhen</small>
                                    </div>
                                    <div class="d-flex w-100 justify-content-start">
                                        <p id="nameToChat @chat.ChatId" class="mb-1 markertext">@chat.Chat.LastMessageSender</p>
                                        <div id="messageToChat @chat.ChatId" class="ordinary-text-color hide-more-text text-sm-left">
                                            @chat.Chat.LastMessageText
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    }
            </ul>
            <a data-toggle="modal" data-target="#exampleModal" data-whatever="" asp-controller="Chat" asp-action="Create" class="col-md-4 float">
                <i class="fa fa-plus my-float"></i>
            </a>
            <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content back">
                        <div class="modal-header border-bottom-0">
                            <h5 class="modal-title markertext" id="exampleModalLabel">New Chat!</h5>
                            <button type="button" class=" close text-light" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>

                        <form asp-action="Create" method="post">
                            <div class="modal-body">
                                <div class="form-group">
                                    <input asp-for="ChatName" class="w-100 concavecard text-white" id="chat-name" placeholder="Enter chatname..">
                                </div>
                            </div>
                            <div class="modal-footer border-top-0 ">
                                <button type="button" class="cardflat headerbutton text-light" data-dismiss="modal">Close</button>
                                <button type="submit" class="create-button headerbutton text-light">Create</button>
                            </div>
                        </form>

                    </div>
                </div>
            </div>
        </div>
        @if (Model.CurrentChatId != null)
        {
            <div class=" text-white col-md-8 order-md-2">
                @* вивід повідомлень*@
                @if (Model.MessageList != null)
                    @foreach (var message in Model.MessageList.OrderBy(m => m.When))
                    {
                        <h5>(@message.When) @message.SenderName : @message.MessageText</h5>
                    }
                <h5 id="messagesList"></h5>@* вивід нових повідомлень*@

                <div>
                    <input hidden value="@User.Identity.Name" id="userInput" /> @*константи*@
                    <input hidden value="@Model.CurrentUserId" id="userId" />
                    <input id="chatId" asp-for="CurrentChatId" value="@Model.CurrentChatId" type="hidden" />

                    @* поле вводу *@
                    <label asp-for="NewMessageText" class="col-sm-2 col-form-label"></label>
                    <div class="col-sm-10">
                        <input id="messageInput" asp-for="NewMessageText" class="form-control" placeholder="WriteMessage">
                    </div>
                    @* кнопка відправлення *@
                    <div class="col-sm-10">
                        <button id="sendButton" type="submit" class="btn btn-primary">Send</button>
                    </div>
                    @* "кнопка" редагувати чат *@
                    <div><a asp-action="EditChat" asp-route-chatId="@Model.CurrentChatId">EditChat</a></div>
                </div>
            </div>
        }
    </div>
</div>

<script src="~/js/signalr/dist/browser/signalr.min.js"></script>
<script src="~/js/chat.js"></script>